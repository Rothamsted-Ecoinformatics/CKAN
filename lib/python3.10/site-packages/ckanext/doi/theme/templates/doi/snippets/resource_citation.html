{#
Renders a citation for a resource
#}

{% extends "doi/snippets/package_citation.html" %}

{% block citation %}
    <section class="module additional-info">
        <div class="module-content citation">
            <h3>{{ _('Cite this file as') }}</h3>

            <div id="citation-string" class="citation-string">
                {% block default_citation_string %}
                <div id="resourceCitationDiv"></div>
                <!-- {{ pkg_dict['author'] }} ({{ h.package_get_year(pkg_dict) }}). <i>{{ res['name'] }}</i> (from <i>{{ pkg_dict['title'] }}, doi: https://doi.org/{{ pkg_dict['doi'] }}</i>) [Data set resource]. {{ pkg_dict['doi_publisher'] }}. -->
                {% block citation_link %}
                    {% set res_link = h.url_for('resource.read', qualified=True, id=pkg_dict['name'], resource_id=res['id']) %}
                    <a href="{{ res_link }}" target="_blank">
                        {{ res_link }}
                    </a>
                {% endblock %}
                {% endblock %}
            </div>
            <script>
                            let authorNames = "{{pkg_dict['author']}}".split(",");
            function convertToCitation(names) {
                return names.map(name => {
                    const parts = name.split(' ');
                    const lastName = parts[parts.length - 1];
                    const initials = parts.slice(0, parts.length - 1).map(part => part[0].toUpperCase()).join(' ');
                    return `${lastName} ${initials}.`;
                });
            }

            citationName = convertToCitation(authorNames);
            citationName = citationName.join(", ");
            document.getElementById("resourceCitationDiv").innerHTML = citationName + "({{ h.package_get_year(pkg_dict) }}). <i>{{ res['name'] }}</i> (from <i>{{ pkg_dict['title'] }}, doi: https://doi.org/{{ pkg_dict['doi'] }}</i>) [Data set resource]. {{ pkg_dict['doi_publisher'] }}.";
            </script>
            {% block citation_status %}
                {{ super() }}
            {% endblock %}
        </div>
    </section>
{% endblock %}
